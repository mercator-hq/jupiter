# Example mTLS Configuration for Mercator Jupiter
# This demonstrates mutual TLS setup for high-security environments
# Use case: Service-to-service authentication, zero-trust networks

proxy:
  listen_address: "0.0.0.0:8443"
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

security:
  tls:
    enabled: true
    cert_file: "/etc/mercator/certs/server.crt"
    key_file: "/etc/mercator/certs/server.key"
    min_version: "1.3"

    # Enable mutual TLS for client certificate authentication
    mtls:
      enabled: true

      # CA certificate that signed client certificates
      client_ca_file: "/etc/mercator/certs/client-ca.pem"

      # Require valid client certificates for all requests
      client_auth_type: "require"
      verify_client_cert: true

      # Extract client identity from certificate Common Name
      # This can be used in policy rules for authorization
      identity_source: "subject.CN"

# Example policy using client certificate identity
policy:
  mode: "file"
  file_path: "/etc/mercator/policies.yaml"
  watch: true

providers:
  openai:
    base_url: "https://api.openai.com/v1"
    api_key: "${OPENAI_API_KEY}"

telemetry:
  logging:
    level: "info"
    format: "json"

---
# Example policies.yaml for mTLS-based authorization
# This would be in a separate file referenced above

policies:
  - name: "client-based-access"
    description: "Allow specific clients based on certificate identity"
    rules:
      - condition: "client_identity == 'service-a'"
        action: "allow"
        providers: ["openai"]

      - condition: "client_identity == 'service-b'"
        action: "allow"
        providers: ["anthropic"]

      - condition: "client_identity == 'admin-service'"
        action: "allow"
        providers: ["openai", "anthropic"]

      # Deny all other clients
      - condition: "true"
        action: "deny"
        message: "Client not authorized"
